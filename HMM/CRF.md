# 条件随机场 conditional random field

## 定义

>CRF 是条件概率分布模型 $P(Y | X)$，表示的是给定一组输入随机变量 $X$ 的条件下另一组输出随机变量 $Y$ 的马尔可夫随机场

## 马尔可夫随机场（概率无向图模型）

>设联合概率分布 $P(V)$ 由无向图 $G$ 表示，节点表示随机变量，边表示随机变量间的依赖关系。如果 $G$ 满足成对、局部或全局马尔可夫性，称 $P(V)$ 为概率无向图模型

- 成对马尔可夫性

>>设无向图 $G$ 中任意两个没有边连接的节点 $u、v$，其它所有节点集合为 $O$，成对马尔可夫性指：给定 $Y_O$ 的条件下，$Y_u$ 和 $Y_v$ 条件独立，故有
>>$$P(Y_u | Y_O, Y_v) = P(Y_u | Y_O)$$

- 局部马尔可夫性

>>设无向图 $G$ 中任一个的节点 $v$，与 $v$ 有边连接的节点集合为 $W$，其它所有节点集合为 $O$，局部马尔可夫性指：给定 $Y_W$ 的条件下，$Y_O$ 和 $Y_v$ 条件独立

- 全局马尔可夫性

>>设节点集合 $A、B$ 是在无向图 $G$ 中被节点集合 $C$ 分开的任意节点集合，全局马尔可夫性指：给定 $Y_C$ 的条件下，$Y_A$ 和 $Y_B$ 条件独立

>概率无向图的联合概率分布可以表示为所有最大团的势函数的乘积（Hammersley-Clifford 定理）
>$$P(Y) = \frac1Z \prod_C \Psi_C(Y_C)$$
>其中势函数要求严格正，所以通常定义为指数函数

- 最大团
>>多个节点，如果两两相连，称为团；如果不能再添加节点，称为最大团

## 线性链条件随机场

>输入随机变量和输出随机变量为长度相等的状态序列和观察序列，满足局部马尔可夫性，即对任意位置 $i$,
>$$P(y_i | X, y1, ..., y_{i−1}, y_{i+1}, ..., y_n) = P(y_i | X, y_{i−1}, y_{i+1})$$

>特征函数 $f_a(y_i, y_{i-1}, X, i)$，表示观察序列 $X$ 和状态 $y_i, y_{i-1}$ 是否满足某一条件 $a$，为零一函数
>$$P(Y | X) = \frac {exp(\sum_a \sum_i {\lambda_a f_a(y_i, y_{i-1}, X, i)})} {Z(X)}$$

## 比较

>CRF 没有 HMM 那样对观察序列有严格的独立性假设条件，因而可以容纳任意的上下文信息

>同时，由于 CRF 对观察序列进行全局归一化，它还克服了 MEMM 的标注偏置问题

>训练代价大、复杂度高

## 计算问题

>给定一个条件随机场 $P(Y | X)$、观测序列 $X$ 和状态序列 $Y$，计算 $P(y_i | X)$、$P(y_{i−1}, y_i | X)$ 以及特征函数关于分布的期望

>TODO:前向后向算法

## 解码问题

>给定条件随机场 $P(Y | X)$ 和观测序列 $X$ ，求最有可能的状态序列

- 使用维特比算法求解

>最优路径，必然是前一时刻的部分最优路径和当前状态的组合之一
>>部分最优路径：某一时刻，状态取不同值时的最优序列

## TODO:学习问题

## CRF++ 使用

#### 语料文件格式

>训练、测试、预测数据的格式都相同

>拿命名实体识别来说：每一行对应一个单元（词），有多个属性和一个状态，用空格分隔；一般来说第一个属性是单词本身，第二个属性是词性；每个句子用空行分隔；

#### 程序调用

>训练使用 crf_learn，测试和预测共用 crf_test

#### 特征模版

>分为 Unigram 和 Bigram 两种

>ex: U01:%x[0,0]/%x[2,1]

>U 表示 Unigram ，01 是模版编号，%x 表示占位，[2,1] 表示该单元后2位置的词的第2个属性

>一般 Bigram 只写一行 B，表示不使用任何观察属性
